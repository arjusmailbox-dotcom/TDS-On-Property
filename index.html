<!DOCTYPE ahtml>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form 26QB Data Collector (Internal Use Only)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light gray background */
        }
        .form-container {
            max-width: 900px;
            background-color: #ffffff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
        .section-header {
            background-color: #0d47a1; /* Deep Blue header */
            color: white;
        }
        .input-group label {
            font-weight: 600;
            color: #333;
        }
        .required-asterisk {
            color: #e53e3e; /* Red for mandatory fields */
            margin-left: 4px;
        }
        /* Style to mimic government portal buttons */
        .submit-btn {
            background-color: #1e88e5; /* Government blue */
            transition: background-color 0.3s;
        }
        .submit-btn:hover {
            background-color: #0d47a1;
        }
        /* Style for hardcoded display fields */
        .hardcoded-field {
            background-color: #e5e7eb; /* Gray-200 for read-only look */
            cursor: not-allowed;
            font-weight: 500;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="form-container mx-auto mt-4 rounded-lg">
        <!-- Header Mimicking Gov Site -->
        <header class="section-header p-4 rounded-t-lg rounded-b-lg">
            <h1 class="2xl font-bold">Online Form for Furnishing Details Required for Filing TDS on Property</h1>
            <p class="text-sm font-light mt-1">Tax Deducted at Source on Transfer of Immovable Property (Section 194-IA)</p>
        </header>

        <form id="form26qb" class="p-6 md:p-8 space-y-8">

            <!-- Section 1: Transaction Details -->
            <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">I. Basic Transaction Details</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    
                    <!-- 1. More than one Buyer Field -->
                    <div class="input-group col-span-full">
                        <label class="block mb-2">Whether more than one Buyer as per Agreement<span class="required-asterisk">*</span></label>
                        <div class="flex space-x-6 mt-1">
                            <label class="inline-flex items-center">
                                <input type="radio" name="multipleBuyers" value="Yes" required onchange="toggleSecondApplicant(this.value);"
                                    class="form-radio h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                <span class="ml-2 text-gray-700">Yes</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="multipleBuyers" value="No" required onchange="toggleSecondApplicant(this.value);"
                                    class="form-radio h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                <span class="ml-2 text-gray-700">No</span>
                            </label>
                        </div>
                    </div>

                    <!-- 2. Conditional Fields for Second Buyer (Initially Hidden) -->
                    <div id="secondBuyerFields" class="grid grid-cols-1 md:grid-cols-2 gap-6 col-span-full hidden border-t border-gray-300 pt-4 mt-4">
                        <div class="input-group">
                            <label for="buyer2Pan">PAN of 2nd Applicant<span class="required-asterisk">*</span></label>
                            <input type="text" id="buyer2Pan" name="buyer2Pan" maxlength="10" 
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md uppercase focus:ring-blue-500 focus:border-blue-500" placeholder="ABCDE1234F">
                        </div>
                        <div class="input-group">
                            <label for="buyer2Name">Name of 2nd Applicant<span class="required-asterisk">*</span></label>
                            <input type="text" id="buyer2Name" name="buyer2Name" 
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    
                    <!-- 3. Last Installment Field -->
                    <div class="input-group">
                        <label class="block mb-2">Whether it is last installment?<span class="required-asterisk">*</span></label>
                        <div class="flex space-x-6 mt-1">
                            <label class="inline-flex items-center">
                                <input type="radio" name="isLastInstallment" value="Yes" required
                                    class="form-radio h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                <span class="ml-2 text-gray-700">Yes</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="isLastInstallment" value="No" required
                                    class="form-radio h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500">
                                <span class="ml-2 text-gray-700">No</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- 4. Payment Type (MODIFIED to hardcoded text) -->
                    <div class="input-group">
                        <label class="block mb-2">Payment Type<span class="required-asterisk">*</span></label>
                        <!-- Hidden input to submit the fixed value -->
                        <input type="hidden" name="transactionType" value="installment">
                        <!-- Display label for the fixed value -->
                        <div class="w-full mt-1 p-2 border border-gray-300 rounded-md hardcoded-field text-gray-700">
                            Instalment
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Buyer (Deductor) Details -->
            <div class="border border-gray-200 rounded-lg p-4">
                <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">II. Details of Buyer</h2>
                
                <!-- START 1ST APPLICANT DETAILS BLOCK -->
                <div id="applicant1Details">
                    <!-- CHANGED TEXT COLOR TO INDIGO-700 -->
                    <h3 id="applicant1Heading" class="text-lg font-semibold text-indigo-700 mb-3">Buyer Details</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        
                        <!-- 1. Name of Buyer (UPDATED ORDER) -->
                        <div class="input-group">
                            <label id="buyer1NameLabel" for="buyer1Name">Name of Buyer<span class="required-asterisk">*</span></label>
                            <input type="text" id="buyer1Name" name="buyer1Name" required
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Enter Buyer Name...">
                        </div>
                        
                        <!-- 2. PAN of Buyer (UPDATED ORDER) -->
                        <div class="input-group">
                            <label id="buyer1PanLabel" for="buyer1Pan">PAN of Buyer<span class="required-asterisk">*</span></label>
                            <input type="text" id="buyer1Pan" name="buyer1Pan" maxlength="10" required
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md uppercase focus:ring-blue-500 focus:border-blue-500" placeholder="ABCDE1234F">
                        </div>

                        <!-- 3. Residential Status (UPDATED ORDER) -->
                        <div class="input-group">
                            <label for="buyer1Status">Residential Status<span class="required-asterisk">*</span></label>
                            <select id="buyer1Status" name="buyer1Status" required
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                <option value="resident">Resident</option>
                                <option value="nri">Non-Resident Indian (NRI)</option>
                            </select>
                        </div>
                    </div>

                    <!-- 1ST APPLICANT CONTACT & OWNERSHIP (New Row Order) -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                        <div class="input-group md:col-span-1">
                            <label for="buyer1Email">Email ID<span class="required-asterisk">*</span></label>
                            <input type="email" id="buyer1Email" name="buyer1Email" required
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="example@domain.com">
                        </div>
                        <div class="input-group md:col-span-1">
                            <label for="buyer1Mobile">Mobile Number<span class="required-asterisk">*</span></label>
                            <input type="tel" id="buyer1Mobile" name="buyer1Mobile" maxlength="10" required
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 9895012345">
                        </div>
                        <div id="buyer1OwnershipRow" class="input-group md:col-span-1 hidden">
                            <label for="buyer1Ownership">Percentage of Ownership in %<span class="required-asterisk">*</span></label>
                            <input type="number" id="buyer1Ownership" name="buyer1Ownership" min="1" max="100" 
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 50">
                        </div>
                    </div>
                    
                    <!-- REMOVED: 1ST APPLICANT ADDRESS Sub-Fields -->
                    
                </div>
                <!-- END 1ST APPLICANT DETAILS BLOCK -->

                
                <!-- START 2ND APPLICANT DETAILS BLOCK (HIDDEN BY DEFAULT) -->
                <div id="applicant2Details" class="hidden border-t border-gray-300 pt-6 mt-6">
                    <!-- CHANGED TEXT COLOR TO RED-700 -->
                    <h3 class="text-lg font-semibold text-red-700 mb-3">2nd Applicant Details</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

                        <!-- 1. Name of 2nd Applicant (UPDATED ORDER) -->
                        <div class="input-group">
                            <label for="buyer2Name">Name of Buyer (2nd Applicant)<span class="required-asterisk">*</span></label>
                            <input type="text" id="buyer2Name" name="buyer2Name" 
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Enter 2nd Applicant Name...">
                        </div>

                        <!-- 2. PAN of 2nd Applicant (UPDATED ORDER) -->
                        <div class="input-group">
                            <label for="buyer2Pan">PAN of Buyer (2nd Applicant)<span class="required-asterisk">*</span></label>
                            <input type="text" id="buyer2Pan" name="buyer2Pan" maxlength="10" 
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md uppercase focus:ring-blue-500 focus:border-blue-500" placeholder="ABCDE1234F">
                        </div>

                        <!-- 3. Residential Status (Default to Resident, but configurable) -->
                        <div class="input-group">
                            <label for="buyer2Status">Residential Status<span class="required-asterisk">*</span></label>
                            <select id="buyer2Status" name="buyer2Status"
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                <option value="resident">Resident</option>
                                <option value="nri">Non-Resident Indian (NRI)</option>
                            </select>
                        </div>
                    </div>

                    <!-- 2ND APPLICANT CONTACT & OWNERSHIP (New Row Order) -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                        <div class="input-group md:col-span-1">
                            <label for="buyer2Email">Email ID<span class="required-asterisk">*</span></label>
                            <input type="email" id="buyer2Email" name="buyer2Email"
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="example@domain.com">
                        </div>
                        <div class="input-group md:col-span-1">
                            <label for="buyer2Mobile">Mobile Number<span class="required-asterisk">*</span></label>
                            <input type="tel" id="buyer2Mobile" name="buyer2Mobile" maxlength="10"
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 9895012345">
                        </div>
                        <div class="input-group md:col-span-1">
                            <label for="buyer2Ownership">Percentage of Ownership in %<span class="required-asterisk">*</span></label>
                            <input type="number" id="buyer2Ownership" name="buyer2Ownership" min="1" max="100" 
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 50">
                        </div>
                    </div>

                    <!-- REMOVED: 2ND APPLICANT ADDRESS Sub-Fields -->
                </div>
                <!-- END 2ND APPLICANT DETAILS BLOCK -->

            </div>

            <!-- Section 3: Property Details (Renumbered from IV) -->
            <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-4">III. Property Details</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- 1. Type of Property (MODIFIED to fixed value) -->
                    <div class="input-group">
                        <label for="propertyType">Type of Property<span class="required-asterisk">*</span></label>
                        <!-- Hidden input to submit the fixed value -->
                        <input type="hidden" id="propertyType" name="propertyType" value="building">
                        <!-- Display label for the fixed value -->
                        <div class="w-full mt-1 p-2 bg-white border border-gray-300 rounded-md text-gray-700 font-medium hardcoded-field">
                            Building (Apartments, Flats, Shops, etc.)
                        </div>
                    </div>

                    <!-- 2. Project Name (NEW FIELD) -->
                    <div class="input-group">
                        <label for="projectName">Project Name<span class="required-asterisk">*</span></label>
                        <select id="projectName" name="projectName" required
                            class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select Project</option>
                            <option value="Sobha Meadows Whispering Hills">Sobha Meadows Whispering Hills</option>
                            <option value="Sobha Ridge Whispering Hills">Sobha Ridge Whispering Hills</option>
                        </select>
                    </div>
                    
                    <!-- 3. Total Value of Consideration -->
                    <div class="input-group">
                        <label for="saleConsideration">Total Value of Consideration (Property Value) in ₹<span class="required-asterisk">*</span></label>
                        <input type="number" id="saleConsideration" name="saleConsideration" min="5000000" required
                            class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 6000000">
                    </div>
                </div>

                <!-- START: Property Address Sub-Fields -->
                <div class="space-y-4 mt-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Flat / Door / Building renamed to Apartment Number (Input remains active) -->
                        <div class="input-group">
                            <label for="propertyFlat">Apartment Number<span class="required-asterisk">*</span></label>
                            <input type="text" id="propertyFlat" name="propertyFlatDoorBuilding" required
                                class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    
                    <!-- Hidden inputs for hardcoded address data -->
                    <input type="hidden" name="propertyCountry" value="India">
                    <input type="hidden" name="propertyPinCode" value="560103">
                    <input type="hidden" name="propertyPostOffice" value="Bellandur">
                    <input type="hidden" name="propertyAreaLocality" value="Devara Beesana Halli">
                    <input type="hidden" name="propertyDistrict" value="Bangalore">
                    <input type="hidden" name="propertyState" value="Karnataka">

                </div>
                <!-- END: Property Address Sub-Fields -->

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                    <div class="input-group">
                        <label for="dateAgreement">Date of Agreement/Booking<span class="required-asterisk">*</span></label>
                        <input type="date" id="dateAgreement" name="dateAgreement" required
                            class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div class="input-group">
                        <label for="datePayment">Date of Payment/Credit Made to Seller<span class="required-asterisk">*</span></label>
                        <input type="date" id="datePayment" name="datePayment" required
                            class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                
                <!-- Total amount paid/ credited in previous installments, if any -->
                <div class="input-group mt-6">
                    <label for="previousInstallments">Total amount paid/ credited in previous installments, if any</label>
                    <input type="number" id="previousInstallments" name="previousInstallmentsTotal" value="0" min="0"
                        class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <span id="previousInstallmentsExGST" class="text-xs text-gray-500 mt-1 block"></span>
                </div>
                <!-------------------------------------------------------------------------->

                <!-- FINAL UPDATED GRID LAYOUT FOR AMOUNTS -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                    <div class="input-group md:col-span-1">
                        <label for="amountPaid">Amount Paid/Credited Currently<span class="required-asterisk">*</span></label>
                        <input type="number" id="amountPaid" name="amountPaid" required
                            class="w-full mt-1 p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" placeholder="Amount on which TDS to be deducted">
                        <span id="amountPaidExGST" class="text-xs text-gray-500 mt-1 block"></span>
                    </div>
                    <div class="input-group md:col-span-1">
                        <label for="tdsAmount">TDS Amount Deducted (1% of Amount Paid)<span class="required-asterisk">*</span></label>
                        <input type="text" id="tdsAmount" name="tdsAmount" readonly
                            class="w-full mt-1 p-2 border border-gray-300 rounded-md bg-gray-200 cursor-not-allowed font-bold text-green-700">
                    </div>
                    <!-- HIDDEN TDS RATE FIELD -->
                    <div class="input-group hidden">
                        <label for="tdsRate">TDS Rate (%)<span class="required-asterisk">*</span></label>
                        <input type="number" id="tdsRate" name="tdsRate" value="1.00" step="0.01" min="0.01" required disabled>
                    </div>
                </div>
            </div>
            
            <!-- REMOVED: NEW SECTION IV: TDS Filing Details -->
            <!-- The section for fees details has been removed. -->

            <!-- Declaration -->
            <div class="flex items-start mt-8">
                <input type="checkbox" id="declaration" name="declaration" required
                    class="h-4 w-4 text-blue-600 border-gray-300 rounded mt-1 focus:ring-blue-500">
                <label for="declaration" class="ml-2 text-sm text-gray-700">I declare that the details furnished above are correct to the best of my knowledge.</label>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-center pt-4">
                <button type="submit" class="submit-btn text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:shadow-xl transition duration-200">
                    Submit Data
                </button>
            </div>
        </form>
    </div>

    <!-- Custom Success/Error Modal -->
    <div id="resultModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl max-w-lg w-full p-6">
            <h3 id="modalTitle" class="text-2xl font-bold mb-4 text-blue-700"></h3>
            <div id="modalContent" class="text-gray-700 space-y-3 text-sm"></div>
            <button onclick="document.getElementById('resultModal').classList.add('hidden')"
                class="mt-6 w-full py-2 submit-btn text-white font-bold rounded-md">
                Close
            </button>
        </div>
    </div>

    <script>
        // References for 1st Applicant
        const applicant1Heading = document.getElementById('applicant1Heading');
        const buyer1PanLabel = document.getElementById('buyer1PanLabel');
        const buyer1NameLabel = document.getElementById('buyer1NameLabel');
        const buyer1OwnershipInput = document.getElementById('buyer1Ownership');
        const buyer1OwnershipRow = document.getElementById('buyer1OwnershipRow'); // Reference to the row/container
        const buyer1StatusInput = document.getElementById('buyer1Status');
        const buyer1EmailInput = document.getElementById('buyer1Email');
        const buyer1MobileInput = document.getElementById('buyer1Mobile');
        
        const previousInstallmentsInput = document.getElementById('previousInstallments');
        const previousInstallmentsExGSTSpan = document.getElementById('previousInstallmentsExGST');
        
        const amountPaidInput = document.getElementById('amountPaid');
        const amountPaidExGSTSpan = document.getElementById('amountPaidExGST');
        
        const tdsAmountInput = document.getElementById('tdsAmount');

        // REMOVED: TDS Filing Refs (numTDSInput, filingFeesInput, etc.)

        
        const originalPanText = 'PAN of Buyer';
        const originalNameText = 'Name of Buyer';
        const GST_FACTOR = 1.05; // 100% + 5% GST (1.05)

        // References for 2nd Applicant
        const applicant2DetailsDiv = document.getElementById('applicant2Details');
        const buyer2PanInput = document.getElementById('buyer2Pan');
        const buyer2NameInput = document.getElementById('buyer2Name');
        const buyer2OwnershipInput = document.getElementById('buyer2Ownership');
        const buyer2EmailInput = document.getElementById('buyer2Email');
        const buyer2MobileInput = document.getElementById('buyer2Mobile');
        const buyer2StatusInput = document.getElementById('buyer2Status');
        
        // Helper function to set required status for all 2nd Applicant fields
        function setApplicant2Required(isRequired) {
            buyer2PanInput.required = isRequired;
            buyer2NameInput.required = isRequired;
            buyer2OwnershipInput.required = isRequired; 
            buyer2EmailInput.required = isRequired;
            buyer2MobileInput.required = isRequired;
            buyer2StatusInput.required = isRequired; 
        }
        
        // Helper function to clear all 2nd Applicant fields
        function clearApplicant2Fields() {
            buyer2PanInput.value = '';
            buyer2NameInput.value = '';
            buyer2OwnershipInput.value = ''; 
            buyer2EmailInput.value = '';
            buyer2MobileInput.value = '';
            buyer2StatusInput.value = 'resident'; 
        }

        // REMOVED: updateTDSFilingDetails() function

        // Function to toggle the second buyer fields and rename the first buyer's fields
        function toggleSecondApplicant(value) {
            const panAsterisk = '<span class="required-asterisk">*</span>';
            const nameAsterisk = '<span class="required-asterisk">*</span>';
            const buyer1NameInput = document.getElementById('buyer1Name');
            const buyer2NameInput = document.getElementById('buyer2Name');
            
            if (value === 'Yes') {
                // --- MULTIPLE BUYERS: YES ---
                
                // 1. Rename 1st Applicant fields and show heading
                applicant1Heading.textContent = '1st Applicant Details';
                buyer1PanLabel.innerHTML = `${originalPanText} (1st Applicant)${panAsterisk}`;
                buyer1NameLabel.innerHTML = `${originalNameText} (1st Applicant)${nameAsterisk}`;
                
                // Set Placeholder for 1st Applicant
                buyer1NameInput.placeholder = 'Enter 1st Applicant Name...';

                // 2. Show 1st Applicant Ownership field and keep required
                buyer1OwnershipRow.classList.remove('hidden');
                buyer1OwnershipInput.required = true;
                
                // 3. Rename 1st Applicant Address Heading (keeping logic placeholder)
                // buyer1AddressHeading.textContent = 'Communication Address (Applicant 1)';

                // 4. Show 2nd Applicant fields and set required
                applicant2DetailsDiv.classList.remove('hidden');
                setApplicant2Required(true);

                // Set Placeholder for 2nd Applicant
                buyer2NameInput.placeholder = 'Enter 2nd Applicant Name...';


            } else {
                // --- MULTIPLE BUYERS: NO ---
                
                // 1. Restore original field names
                applicant1Heading.textContent = 'Buyer Details';
                buyer1PanLabel.innerHTML = `${originalPanText}${panAsterisk}`;
                buyer1NameLabel.innerHTML = `${originalNameText}${nameAsterisk}`;
                
                // Restore Placeholder for single Buyer
                buyer1NameInput.placeholder = 'Enter Buyer Name...';

                // 2. HIDE 1st Applicant Ownership field, remove required, and clear value
                buyer1OwnershipRow.classList.add('hidden');
                buyer1OwnershipInput.required = false;
                buyer1OwnershipInput.value = '';
                
                // 3. Restore 1st Applicant Address Heading (keeping logic placeholder)
                // buyer1AddressHeading.textContent = 'Communication Address of the Buyer';

                // 4. Hide 2nd Applicant fields and clear values
                applicant2DetailsDiv.classList.add('hidden');
                setApplicant2Required(false);
                clearApplicant2Fields();
            }
        }

        // Function to calculate TDS automatically 
        const calculateTDS = () => {
            const tdsRate = 0.01;
            const amountPaidWithGST = parseFloat(amountPaidInput.value) || 0;
            
            // 1. Calculate Amount Excluding GST: Amount / 1.05
            // NOTE: The label currently reads "Amount Paid/Credited Currently" without mentioning GST,
            // but the GST factor (1.05) is kept in the calculation based on the previous structure 
            // for calculating the TDS base (which is typically on the consideration value excluding GST/Tax).
            const amountExcludingGST = amountPaidWithGST / GST_FACTOR;
            
            // 2. Calculate TDS: Amount Excluding GST * 1%
            const tdsCalculated = amountExcludingGST * tdsRate;

            tdsAmountInput.value = tdsCalculated.toFixed(2);
        };
        
        function calculateExGST(inputElement, outputElement) {
            const value = parseFloat(inputElement.value) || 0;
            if (value > 0) {
                const exGstAmount = value / GST_FACTOR;
                outputElement.textContent = `(Amount excluding GST (5% assumed): ₹ ${exGstAmount.toFixed(2)})`;
            } else {
                outputElement.textContent = '';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('form26qb');
            const tdsRate = 0.01; // 1%
            
            // --- Formspree Configuration ---
            const FORMSPREE_URL = 'https://formspree.io/f/xyzrjoea'; 
            const TARGET_EMAIL = 'arjusmailbox@gmail.com';
            // -------------------------------

            // Initial state toggle
            const initialBuyerStatus = document.querySelector('input[name="multipleBuyers"]:checked');
            if (initialBuyerStatus) {
                toggleSecondApplicant(initialBuyerStatus.value);
            } else {
                toggleSecondApplicant('No');
            }
            // REMOVED: Initial call for updateTDSFilingDetails()

            // --- Event Listeners for Dynamic Calculations ---
            
            // Listener for Amount Paid/Credited Currently (requires both GST and TDS calculation)
            amountPaidInput.addEventListener('input', () => {
                calculateTDS();
                calculateExGST(amountPaidInput, amountPaidExGSTSpan);
            });
            
            // Listener for Previous Installments (only requires GST calculation)
            previousInstallmentsInput.addEventListener('input', () => {
                calculateExGST(previousInstallmentsInput, previousInstallmentsExGSTSpan);
            });
            
            // Event listener for multipleBuyers radio buttons
            document.querySelectorAll('input[name="multipleBuyers"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    toggleSecondApplicant(radio.value);
                    // REMOVED: updateTDSFilingDetails() call
                });
            });


            // Initial calculation check in case of browser autofill
            calculateTDS();
            calculateExGST(amountPaidInput, amountPaidExGSTSpan);
            calculateExGST(previousInstallmentsInput, previousInstallmentsExGSTSpan);
            // ------------------------------------------------


            const showModal = (title, contentHTML) => {
                document.getElementById('modalTitle').textContent = title;
                document.getElementById('modalContent').innerHTML = contentHTML;
                document.getElementById('resultModal').classList.remove('hidden');
            };

            // Enhanced validation for PAN format
            const validatePan = (pan) => {
                const panRegex = /^[A-Z]{5}[0-9]{4}[A-Z]{1}$/;
                return panRegex.test(pan.toUpperCase());
            }

            const handleSubmit = async (event) => {
                event.preventDefault();

                // 1. Client-Side Validation
                const buyer1Pan = document.getElementById('buyer1Pan').value;
                const multipleBuyersSelected = document.querySelector('input[name="multipleBuyers"]:checked')?.value;

                if (!validatePan(buyer1Pan)) {
                    showModal("Validation Error", "Please enter a valid 10-digit PAN for the 1st Applicant.");
                    return;
                }
                
                if (multipleBuyersSelected === 'Yes') {
                    if (!validatePan(buyer2PanInput.value)) {
                        showModal("Validation Error", "Please enter a valid 10-digit PAN for the 2nd Applicant.");
                        return;
                    }
                }
                
                // 2. Data Collection
                const formData = new FormData(form);
                const data = {};
                for (let [key, value] of formData.entries()) {
                    // Normalize PAN to uppercase
                    if (key.includes('Pan')) {
                        data[key] = value.toUpperCase();
                    } else {
                        data[key] = value;
                    }
                }
                
                // Manually inject hardcoded Seller data
                data.sellerName = "Sobha Limited";
                data.sellerPan = "AABCS7723E";
                data.sellerStatus = "resident";
                data.sellerEmail = "radhakrishnan.m@sobha.com";
                data.sellerMobile = "9880034900";
                data.sellerCountry = "India";
                data.sellerFlatDoorBuilding = "55/1, Devarabisanahalli";
                data.sellerPinCode = "560103";
                data.sellerPostOffice = "Bellandur";
                data.sellerAreaLocality = "Devara Beesana Halli";
                data.sellerDistrict = "Bangalore";
                data.sellerState = "Karnataka";

                // Add calculated fields for clarity in the email body
                data._subject = `New Form 26QB Data Submission from ${data.buyer1Name}`;
                data.tdsAmount = tdsAmountInput.value;
                data.tdsRate = tdsRate.toFixed(2);
                data.RecipientEmail = TARGET_EMAIL; 
                // Add calculated GST fields to submission data
                data.previousInstallmentsExGST = previousInstallmentsExGSTSpan.textContent;
                data.amountPaidExGST = amountPaidExGSTSpan.textContent;
                
                // REMOVED: data.numTDS and data.filingFees


                // 3. ACTUAL Data Submission via Formspree
                
                try {
                    const response = await fetch(FORMSPREE_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        const successContent = `
                            <p class="text-green-600 font-semibold text-lg">Submission Successful!</p>
                        `;
                        showModal("Data Submitted", successContent);
                        form.reset(); 
                        toggleSecondApplicant('No'); 
                        // REMOVED: updateTDSFilingDetails() call
                        // Clear GST fields on reset
                        previousInstallmentsExGSTSpan.textContent = '';
                        amountPaidExGSTSpan.textContent = '';

                    } else {
                        const errorData = await response.json();
                        let errorMsg = errorData.error ? `Formspree Error: ${errorData.error}` : 'Unknown submission error.';
                        console.error('Formspree Error Response:', errorData);
                        showModal("Submission Error", `<p>Failed to submit data. Please check the following:</p><ul class=\"list-disc list-inside mt-2\"><li>Is the Formspree hash correctly linked to <code>${TARGET_EMAIL}</code>?</li><li>${errorMsg}</li></ul><p class=\"mt-2\">Please try again later.</p>`);
                    }
                } catch (error) {
                    console.error('Network Error:', error);
                    showModal("Network Error", "Could not connect to the submission service. Please check your internet connection.");
                }
            };

            form.addEventListener('submit', handleSubmit);
        });
    </script>
</body>
</html>
